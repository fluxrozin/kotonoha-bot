# ミドルウェア選定書

## 1. 選定方針

- **無料で利用可能**: 無料枠または完全無料
- **安定性**: 実績のある技術
- **保守性**: 適切なドキュメントとコミュニティサポート
- **パフォーマンス**: 場面緘黙支援に適した応答速度

---

## 2. 選定結果一覧

| カテゴリ                   | 選定技術                  | 選定理由                                 | 代替候補               |
| -------------------------- | ------------------------- | ---------------------------------------- | ---------------------- |
| **言語**                   | Python 3.14               | 最新機能、discord.py との互換性          | Python 3.13            |
| **パッケージ管理**         | uv                        | 高速、モダンなパッケージ管理             | pip, poetry            |
| **Discord フレームワーク** | discord.py                | 最も一般的、豊富なドキュメント           | discord.js, disnake    |
| **AI API**                 | Google Gemini API         | 無料枠が実用的、Flash/Pro の使い分け     | Groq API, Hugging Face |
| **データベース**           | SQLite                    | 軽量、ファイルベース、永続化に適している | PostgreSQL, MySQL      |
| **コンテナ**               | Docker                    | 標準的、Synology 対応                    | Podman                 |
| **CI/CD**                  | GitHub Actions            | GitHub と統合、無料                      | GitLab CI, Jenkins     |
| **コンテナレジストリ**     | GitHub Container Registry | GitHub と統合、無料                      | Docker Hub             |
| **自動更新**               | Watchtower                | シンプル、Docker 統合                    | Ouroboros              |

---

## 3. 詳細選定理由

### 3.1 Python 3.14

**選定理由**:

- 最新の Python 機能を利用できる
- discord.py との互換性が高い
- パフォーマンスの改善

**代替候補**: Python 3.13（互換性の観点から）

---

### 3.2 uv（パッケージ管理）

**選定理由**:

- 非常に高速なパッケージ管理
- Rust で実装されており、パフォーマンスが高い
- モダンな依存関係解決

**代替候補**:

- **pip**: 標準的だが、速度が遅い
- **poetry**: 機能が豊富だが、設定が複雑

---

### 3.3 discord.py

**選定理由**:

- Discord Bot 開発で最も一般的
- 豊富なドキュメントとコミュニティサポート
- 非同期処理に対応
- スレッド機能をサポート

**代替候補**:

- **discord.js**: Node.js ベース（Python プロジェクトには不適切）
- **disnake**: discord.py のフォーク（互換性の問題）

---

### 3.4 Google Gemini API

**選定理由**:

- 無料枠が実用的（Flash: 15 回/分、1,500 回/日）
- Flash と Pro の使い分けが可能
- 日本語対応が良好
- Google の安定したインフラ

**代替候補**:

- **Groq API**: 高速だが、応答品質はモデル依存
- **Hugging Face Inference API**: 完全無料だが、レート制限が厳しい
- **Ollama**: ローカル実行だが、セットアップが複雑

---

### 3.5 SQLite

**選定理由**:

- 軽量でファイルベース
- セットアップが不要
- 単一サーバー運用に適している
- 永続化に十分

**代替候補**:

- **PostgreSQL**: 高機能だが、セットアップが複雑
- **MySQL**: 一般的だが、SQLite で十分

**将来の移行**: スケールが必要になった場合、PostgreSQL への移行を検討

---

### 3.6 Docker

**選定理由**:

- 標準的なコンテナ技術
- Synology Container Manager でサポート
- 豊富なドキュメント

**代替候補**:

- **Podman**: Docker 互換だが、Synology でサポートが限定的

---

### 3.7 GitHub Actions

**選定理由**:

- GitHub と統合
- 無料で利用可能
- 設定が簡単

**代替候補**:

- **GitLab CI**: 機能が豊富だが、GitHub を使用しているため不適切
- **Jenkins**: 高機能だが、セットアップが複雑

---

### 3.8 GitHub Container Registry (GHCR)

**選定理由**:

- GitHub と統合
- 無料で利用可能
- Watchtower と連携可能

**代替候補**:

- **Docker Hub**: 一般的だが、レート制限がある

---

### 3.9 Watchtower

**選定理由**:

- シンプルで使いやすい
- Docker コンテナの自動更新
- 設定が簡単

**代替候補**:

- **Ouroboros**: 機能が似ているが、Watchtower の方が一般的

---

## 4. 技術スタックの互換性

### 4.1 互換性マトリックス

| 技術            | Python 3.14 | discord.py | SQLite | Docker | 備考                  |
| --------------- | ----------- | ---------- | ------ | ------ | --------------------- |
| **Python 3.14** | ✅          | ✅         | ✅     | ✅     | 全てと互換            |
| **discord.py**  | ✅          | -          | ✅     | ✅     | SQLite は独立         |
| **SQLite**      | ✅          | ✅         | -      | ✅     | Python 標準ライブラリ |
| **Docker**      | ✅          | ✅         | ✅     | -      | 全てをコンテナ化      |

### 4.2 依存関係

```txt
Python 3.14
├── discord.py
│   └── aiohttp (非同期 HTTP)
├── google-generativeai
│   └── google-api-core
├── aiosqlite
│   └── sqlite3 (標準ライブラリ)
└── python-dotenv
```

---

## 5. 選定プロセス

### 5.1 評価基準

| 基準               | 重み | 説明                       |
| ------------------ | ---- | -------------------------- |
| **コスト**         | 30%  | 無料で利用可能か           |
| **パフォーマンス** | 25%  | 応答速度、処理速度         |
| **安定性**         | 20%  | 実績、信頼性               |
| **保守性**         | 15%  | ドキュメント、コミュニティ |
| **拡張性**         | 10%  | 将来の拡張に対応できるか   |

### 5.2 評価結果

| 技術            | コスト | パフォーマンス | 安定性 | 保守性 | 拡張性 | 総合 |
| --------------- | ------ | -------------- | ------ | ------ | ------ | ---- |
| **Python 3.14** | 100    | 90             | 95     | 95     | 90     | 94   |
| **uv**          | 100    | 100            | 80     | 85     | 90     | 93   |
| **discord.py**  | 100    | 85             | 95     | 100    | 85     | 93   |
| **Gemini API**  | 90     | 95             | 95     | 90     | 85     | 92   |
| **SQLite**      | 100    | 85             | 95     | 90     | 70     | 90   |

---

## 6. リスクと対策

### 6.1 技術選定のリスク

| リスク                 | 影響度 | 対策                                         |
| ---------------------- | ------ | -------------------------------------------- |
| **API の無料枠終了**   | 高     | 複数 API に対応、フォールバック機能          |
| **技術の非推奨化**     | 中     | 標準的な技術を選定、コミュニティの動向を監視 |
| **パフォーマンス問題** | 中     | パフォーマンステスト、最適化                 |

---

**作成日**: 2024 年
**バージョン**: 1.0
**作成者**: kotonoha-bot 開発チーム

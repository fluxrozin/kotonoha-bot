# Discord メッセージフォーマット仕様

Discord のメッセージで使用可能なリッチテキスト（Markdown）フォーマットについて説明します。

## 1. サポートされているフォーマット

Discord では Markdown ベースのテキスト装飾がサポートされています。

### 1.1 基本的な装飾

| 装飾           | 書き方                       | 表示例             |
| -------------- | ---------------------------- | ------------------ |
| **太字**       | `**太字**` または `__太字__` | **太字**           |
| _斜体_         | `*斜体*` または `_斜体_`     | _斜体_             |
| **_太字斜体_** | `***太字斜体***`             | **_太字斜体_**     |
| ~~打ち消し線~~ | `~~打ち消し線~~`             | ~~打ち消し線~~     |
| **下線**       | `__下線__`                   | **下線**           |
| スポイラー     | `\|\|ネタバレ\|\|`           | （クリックで表示） |

### 1.2 コード表示

| 装飾             | 書き方                     | 表示例               |
| ---------------- | -------------------------- | -------------------- |
| インラインコード | `` `コード` ``             | `コード`             |
| コードブロック   | ` ```言語名\nコード\n``` ` | 整形されたコード表示 |

**例**:

```text
`インラインコード`
```

```python
# コードブロック（言語指定あり）
def hello():
    print("Hello, World!")
```

### 1.3 引用

| 装飾       | 書き方                 | 表示例               |
| ---------- | ---------------------- | -------------------- |
| 1 行引用   | `> 引用文`             | > 引用文             |
| 複数行引用 | `>>> 複数行の\n引用文` | 複数行の引用ブロック |

### 1.4 見出し

| 装飾             | 書き方        | 表示例       |
| ---------------- | ------------- | ------------ |
| 見出し 1（最大） | `# 見出し1`   | # 見出し 1   |
| 見出し 2（中）   | `## 見出し2`  | ## 見出し 2  |
| 見出し 3（最小） | `### 見出し3` | ### 見出し 3 |

**注意**: 見出しは文字サイズを変更するものではなく、見出しスタイルとして表示されます。

### 1.5 サブテキスト（小さい文字）

| 装飾         | 書き方            | 表示例                     |
| ------------ | ----------------- | -------------------------- |
| サブテキスト | `-# サブテキスト` | 通常より小さく控えめな表示 |

**注意**: サブテキストは一部のクライアントで実験的な機能のため、全ユーザーで同じ見た目になるとは限りません。

---

## 2. サポートされていないフォーマット

### 2.1 水平線

**水平線はサポートされていません**。

- Markdown の `---` や `***` を書いても水平線にはなりません
- 代わりに、区切りが必要な場合は空行や装飾テキストを使用してください

**代替案**:

```text
**━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━**

または

**────────────────────────────────────────**
```

### 2.2 自由なフォントサイズ指定

**CSS のような自由なフォントサイズ指定はできません**。

- 見出し（`#`, `##`, `###`）やサブテキスト（`-#`）でサイズを変えることはできますが、厳密にはフォントサイズの変更ではなく、見出しスタイルとして表示されます
- ピクセル単位やパーセントでのサイズ指定はできません

---

## 3. Embed メッセージ

Discord では Embed を使用することで、よりリッチなメッセージを送信できます。

### 3.1 Embed の特徴

- **最大文字数**: 6,000 文字（タイトル、説明、フィールドの合計）
- **通常メッセージとの比較**: 通常メッセージは 2,000 文字まで
- **カスタマイズ可能**: 色、フッター、画像、サムネイルなど

### 3.2 Embed の構造

```python
discord.Embed(
    title="タイトル",           # 最大 256 文字
    description="説明文",       # 最大 4,096 文字
    color=0x3498DB,            # 色（16進数）
    footer="フッター",          # 最大 2,048 文字
    fields=[                    # 最大 25 個
        {"name": "フィールド名", "value": "値", "inline": False}
    ]
)
```

### 3.3 本プロジェクトでの使用例

現在、本プロジェクトでは応答メッセージに Embed を使用しています：

```python
# utils/message_formatter.py
embed = discord.Embed(
    description=content,        # 応答テキスト
    color=0x3498DB,             # 青色
)
embed.set_footer(text=f"モデル: {model_name}")  # フッターにモデル名
```

---

## 4. メッセージ長制限

| 項目               | 制限                                                |
| ------------------ | --------------------------------------------------- |
| **通常メッセージ** | 最大 2,000 文字                                     |
| **Embed**          | 最大 6,000 文字（タイトル、説明、フィールドの合計） |
| **ファイル添付**   | 最大 25MB（Nitro ユーザーは 50MB）                  |

**実装上の考慮事項**:

- 本プロジェクトでは、2,000 文字を超える応答を自動的に分割しています
- 分割時は連番を付与（`**(1/3)**` など）して送信します

---

## 5. 本プロジェクトでの使用例

### 5.1 メッセージ分割時の連番表示

```python
# utils/message_splitter.py
header = f"**({i}/{total})**\n\n"  # 太字で連番を表示
formatted.append(header + chunk)
```

**表示例**:

```txt
**(1/3)**

これは最初のメッセージです...

**(2/3)**

これは2番目のメッセージです...
```

### 5.2 Embed での応答表示

```python
# utils/message_formatter.py
embed = discord.Embed(
    description="応答テキスト",
    color=0x3498DB,
)
embed.set_footer(text="モデル: anthropic/claude-3-haiku-20240307")
```

**表示例**:

```txt
┌─────────────────────────────────────┐
│ 応答テキスト                         │
│                                     │
│                                     │
│ ─────────────────────────────────  │
│ モデル: anthropic/claude-3-haiku-  │
│       20240307                      │
└─────────────────────────────────────┘
```

---

## 6. 制限事項と注意点

### 6.1 クライアントによる違い

- リッチテキスト表示は、Discord のクライアント（デスクトップ、モバイル、Web）によって挙動が異なることがあります
- 一部のフォーマット（サブテキストなど）は実験的な機能のため、全ユーザーで同じ見た目になるとは限りません

### 6.2 リッチテキストエディタとの互換性

- Discord のリッチテキストエディタと Markdown エディタの切り替えによって、表示が異なることがあります
- リッチテキストエディタで編集すると、一部の Markdown 記法が表示されなくなることがあります

### 6.3 推奨される使用方法

- **太字**: 重要な情報を強調する際に使用
- **コードブロック**: コードやコマンドを表示する際に使用
- **引用**: 他のメッセージを参照する際に使用
- **Embed**: 長文や構造化された情報を表示する際に使用

---

## 7. 参考資料

- [Discord 公式ブログ: リッチメッセージの表示方法](https://discord.com/blog/how-discord-renders-rich-messages-on-the-android-app)
- [Discord 公式ブログ: メッセージの装飾方法](https://discord.com/blog/make-your-discord-messages-bold-italic-underlined-and-more)
- [Discord サポート: Markdown フォーマット](https://support.discord.com/hc/en-us/articles/210298617-Markdown-Text-101-Chat-Formatting-Bold-Italic-Underline-)

---

**作成日**: 2026 年 1 月 15 日
**最終更新日**: 2026 年 1 月 15 日
**バージョン**: 1.0
**作成者**: kotonoha-bot 開発チーム
